<!doctype html><html lang=ru><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Работа с map в Go | Go-Котяра</title><meta name=description content="Полная документация по Golang на русском языке. Tour of Go, руководства, примеры кода и переводы официальной документации."><meta name=keywords content="golang,го,go язык программирования,документация go,golang русский,tour of go,go программирование,обучение go,go примеры"><meta property="og:title" content="Go-Котяра - Документация по Golang на русском"><meta property="og:description" content="Полная документация и переводы материалов по Golang на русском языке"><meta property="og:type" content="website"><meta property="og:url" content="/"><link rel=canonical href=../../docs/blog-maps/><title>Работа с map в Go</title><link rel=preload href=../../css/bundle.min.ae3118e31179d0f22e4dec13bfdfd6dcce59b64dafdd2dd8c961a55d9c423e19.css as=style><link rel=stylesheet href=../../css/bundle.min.ae3118e31179d0f22e4dec13bfdfd6dcce59b64dafdd2dd8c961a55d9c423e19.css><link rel=icon type=image/png href=../../images/icon-cat-bant-right.png sizes=32x32><style>.site-header{background-image:url(/images/header-image.47babd5258d184f688fa360cc0cdb99121f050b226f9e840f64e1581e9b37a66.webp)}</style></head><body><div class=site-wrapper><header class=site-header><div class=header-content><h1 class=site-title>Go-Котяра</h1><p class=site-description>Русскоязычное сообщество Golang</p></div></header><nav class=main-nav><ul><li><a href=../../>Главная</a></li><li><a href=../../tour>A Tour of Go</a></li><li><a href=../../docs>Документация</a></li><li><a href=../../cat-docs>Статьи Котяры</a></li></ul></nav><main class=main-container><aside class=sidebar><div class="widget categories"><div class=telegram-widget><h3>Мы в telegram</h3><p>Присоединяйтесь к нашему сообществу!</p><a href=https://t.me/gocat_dev class=tg-btn target=_blank>Подписаться на @gocat_dev</a></div></div></aside><div class=content><nav class=breadcrumb aria-label="Хлебные крошки"><a href=../../ class=breadcrumb-item>Главная</a>
<span class=breadcrumb-separator>→</span>
<a href=../../docs/ class=breadcrumb-item>Описание раздела Документация</a>
<span class=breadcrumb-separator>→</span>
<span class="breadcrumb-item current">Работа с map в Go</span></nav><article class=lesson><header class=lesson-header><h1>Работа с map в Go</h1></header><div class=lesson-content><p>Эндрю Герранд<br>6 февраля 2013</p><h3 id=введение>Введение</h3><p>Одной из наиболее полезных структур данных в информатике является <strong>хэш-таблица</strong>. Существует множество реализаций хэш-таблиц с различными свойствами, но в целом они обеспечивают быстрый поиск, добавление и удаление элементов. В Go предоставляется встроенный тип <code>map</code>, который реализует хэш-таблицу.</p><h3 id=объявление-и-инициализация>Объявление и инициализация</h3><p>Тип map в Go выглядит так:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>map</span><span class=p>[</span><span class=nx>KeyType</span><span class=p>]</span><span class=nx>ValueType</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>где <code>KeyType</code> может быть любым <strong>сравниваемым</strong> типом (об этом позже), а <code>ValueType</code> — любым типом, включая другой map!</p><p>Переменная <code>m</code> ниже представляет собой map с ключами типа <code>string</code> и значениями типа <code>int</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Типы map являются <strong>ссылочными типами</strong>, как указатели или срезы, поэтому значение <code>m</code> выше равно <code>nil</code> — оно не ссылается на инициализированную map. При чтении <code>nil</code> map ведёт себя как пустая map, но попытка записи в <code>nil</code> map вызовет панику времени выполнения (<strong>runtime panic</strong>). Так делать не стоит. Для инициализации map используйте встроенную функцию <code>make</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>m</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Функция <code>make</code> выделяет память и инициализирует структуру данных хэш-таблицы, возвращая значение map, которое указывает на неё. Детали реализации этой структуры данных зависят от рантайма и не специфицированы самим языком. В этой статье мы сосредоточимся на <strong>использовании</strong> map, а не на их внутреннем устройстве.</p><h3 id=работа-с-map>Работа с map</h3><p>Go предоставляет привычный синтаксис для работы с map. Этот оператор устанавливает ключу <code>"route"</code> значение <code>66</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>m</span><span class=p>[</span><span class=s>&#34;route&#34;</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=mi>66</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Этот оператор извлекает значение, хранящееся по ключу <code>"route"</code>, и присваивает его новой переменной <code>i</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>[</span><span class=s>&#34;route&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Если запрашиваемый ключ не существует, мы получаем <strong>нулевое значение</strong> для типа значения (<code>ValueType</code>). В данном случае тип значения — <code>int</code>, поэтому нулевое значение равно <code>0</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>j</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>[</span><span class=s>&#34;root&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// j == 0</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Встроенная функция <code>len</code> возвращает количество элементов в map:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>len</span><span class=p>(</span><span class=nx>m</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Встроенная функция <code>delete</code> удаляет запись из map:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nb>delete</span><span class=p>(</span><span class=nx>m</span><span class=p>,</span><span class=w> </span><span class=s>&#34;route&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Функция <code>delete</code> ничего не возвращает и не делает ничего, если указанный ключ не существует.</p><p>Присваивание с <strong>двумя значениями</strong> проверяет наличие ключа:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>i</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>[</span><span class=s>&#34;route&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>В этом операторе первое значение (<code>i</code>) получает значение, хранящееся по ключу <code>"route"</code>. Если ключ не существует, <code>i</code> будет нулевым значением для типа значения (<code>0</code>). Второе значение (<code>ok</code>) имеет тип <code>bool</code> и равно <code>true</code>, если ключ присутствует в map, и <code>false</code> — если отсутствует.</p><p>Чтобы проверить наличие ключа без получения значения, используйте подчёркивание (<code>_</code>) вместо первого значения:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>[</span><span class=s>&#34;route&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Для перебора содержимого map используйте ключевое слово <code>range</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Key:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>key</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Value:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Для инициализации map с данными используйте <strong>литерал map</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>commits</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;rsc&#34;</span><span class=p>:</span><span class=w> </span><span class=mi>3711</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;r&#34;</span><span class=p>:</span><span class=w>   </span><span class=mi>2138</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;gri&#34;</span><span class=p>:</span><span class=w> </span><span class=mi>1908</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;adg&#34;</span><span class=p>:</span><span class=w> </span><span class=mi>912</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Тот же синтаксис можно использовать для инициализации пустой map, что функционально идентично использованию функции <code>make</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>m</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>{}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=использование-нулевых-значений>Использование нулевых значений</h3><p>Бывает удобно, что при отсутствии ключа операция получения значения из map возвращает нулевое значение.</p><p>Например, map с булевыми значениями можно использовать как <strong>структуру данных типа &ldquo;множество&rdquo;</strong> (напомним, что нулевое значение для типа <code>bool</code> — <code>false</code>). В следующем примере выполняется обход связного списка узлов (<code>Node</code>) и вывод их значений. Используется map указателей на <code>Node</code> для обнаружения циклов в списке.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Node</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Next</span><span class=w>  </span><span class=o>*</span><span class=nx>Node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Value</span><span class=w> </span><span class=kd>interface</span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>first</span><span class=w> </span><span class=o>*</span><span class=nx>Node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>visited</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=o>*</span><span class=nx>Node</span><span class=p>]</span><span class=kt>bool</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>first</span><span class=p>;</span><span class=w> </span><span class=nx>n</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=p>;</span><span class=w> </span><span class=nx>n</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>n</span><span class=p>.</span><span class=nx>Next</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=nx>visited</span><span class=p>[</span><span class=nx>n</span><span class=p>]</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;cycle detected&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>break</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>visited</span><span class=p>[</span><span class=nx>n</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>n</span><span class=p>.</span><span class=nx>Value</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Выражение <code>visited[n]</code> равно <code>true</code>, если узел <code>n</code> уже был посещён, или <code>false</code>, если <code>n</code> отсутствует в map. Нет необходимости использовать форму с двумя значениями для проверки наличия <code>n</code> в map — нулевое значение по умолчанию делает это за нас.</p><p>Другой пример полезности нулевых значений — map со <strong>срезами</strong> в качестве значений. Добавление элемента в <code>nil</code> срез просто выделяет новый срез, поэтому добавление значения в map срезов можно выполнить одной строкой; не нужно проверять существование ключа. В следующем примере срез <code>people</code> заполняется значениями типа <code>Person</code>. Каждый <code>Person</code> имеет поле <code>Name</code> и срез <code>Likes</code>. Пример создаёт map для связи каждого предпочтения (<code>like</code>) со срезом людей, которым оно нравится.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Person</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Name</span><span class=w>  </span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Likes</span><span class=w> </span><span class=p>[]</span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>people</span><span class=w> </span><span class=p>[]</span><span class=o>*</span><span class=nx>Person</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>likes</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=o>*</span><span class=nx>Person</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>p</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>people</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>l</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>p</span><span class=p>.</span><span class=nx>Likes</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>likes</span><span class=p>[</span><span class=nx>l</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>likes</span><span class=p>[</span><span class=nx>l</span><span class=p>],</span><span class=w> </span><span class=nx>p</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Чтобы вывести список людей, которые любят сыр:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>p</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>likes</span><span class=p>[</span><span class=s>&#34;cheese&#34;</span><span class=p>]</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>Name</span><span class=p>,</span><span class=w> </span><span class=s>&#34;likes cheese.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Чтобы вывести количество людей, которые любят бекон:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=nx>likes</span><span class=p>[</span><span class=s>&#34;bacon&#34;</span><span class=p>]),</span><span class=w> </span><span class=s>&#34;people like bacon.&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Заметим, что поскольку <code>range</code> и <code>len</code> трактуют <code>nil</code> срез как срез нулевой длины, эти два последних примера будут работать, даже если никто не любит сыр или бекон (как бы маловероятно это ни было).</p><h3 id=типы-ключей>Типы ключей</h3><p>Как упоминалось ранее, ключами map могут быть любые <strong>сравниваемые типы</strong>. Спецификация языка определяет это точно, но коротко: сравниваемыми типами являются логические, числовые, строковые типы, указатели, каналы, интерфейсы, а также структуры или массивы, содержащие только эти типы. Важно отметить, что <strong>срезы, map и функции</strong> отсутствуют в этом списке; эти типы нельзя сравнивать с помощью <code>==</code>, и они <strong>не могут быть ключами map</strong>.</p><p>Очевидно, что строки, целые числа и другие базовые типы могут быть ключами map, но, возможно, неожиданными кажутся ключи-структуры. Структуры позволяют организовать данные по <strong>нескольким измерениям</strong>. Например, эта map map&rsquo;ов может использоваться для подсчёта посещений веб-страниц по странам:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hits</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Это map типа <code>string</code> -> (<code>map[string]int</code>). Каждый ключ внешней map — это путь к веб-странице, имеющей свою внутреннюю map. Каждый ключ внутренней map — это двухбуквенный код страны. Это выражение получает количество загрузок страницы документации пользователями из Австралии:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>hits</span><span class=p>[</span><span class=s>&#34;/doc/&#34;</span><span class=p>][</span><span class=s>&#34;au&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>К сожалению, этот подход становится громоздким при добавлении данных, так как для любого заданного внешнего ключа нужно проверять существование внутренней map и создавать её при необходимости:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=nx>m</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=nx>path</span><span class=p>,</span><span class=w> </span><span class=nx>country</span><span class=w> </span><span class=kt>string</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>mm</span><span class=p>,</span><span class=w> </span><span class=nx>ok</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>m</span><span class=p>[</span><span class=nx>path</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>!</span><span class=nx>ok</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>mm</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nx>m</span><span class=p>[</span><span class=nx>path</span><span class=p>]</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nx>mm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>mm</span><span class=p>[</span><span class=nx>country</span><span class=p>]</span><span class=o>++</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nf>add</span><span class=p>(</span><span class=nx>hits</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/doc/&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;au&#34;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>С другой стороны, дизайн с использованием <strong>одной map и ключа-структуры</strong> устраняет всю эту сложность:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span><span class=w> </span><span class=nx>Key</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>Path</span><span class=p>,</span><span class=w> </span><span class=nx>Country</span><span class=w> </span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>hits</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=nx>Key</span><span class=p>]</span><span class=kt>int</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Когда человек из Вьетнама посещает главную страницу, инкрементировать (и, возможно, создать) соответствующий счётчик — это одна строка:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>hits</span><span class=p>[</span><span class=nx>Key</span><span class=p>{</span><span class=s>&#34;/&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;vn&#34;</span><span class=p>}]</span><span class=o>++</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>И так же просто узнать, сколько людей из Швейцарии прочитали спецификацию:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>hits</span><span class=p>[</span><span class=nx>Key</span><span class=p>{</span><span class=s>&#34;/ref/spec&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;ch&#34;</span><span class=p>}]</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=конкурентность>Конкурентность</h3><p>Map <strong>не безопасны для конкурентного использования</strong>: не определено, что произойдёт при одновременном чтении и записи. Если вам нужно читать из map и писать в неё из параллельно выполняющихся горутин, доступ должен быть защищён каким-либо механизмом синхронизации. Один из распространённых способов защиты map — использование <code>sync.RWMutex</code>.</p><p>Этот оператор объявляет переменную-счётчик, которая является анонимной структурой, содержащей map и встроенный <code>sync.RWMutex</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span><span class=w> </span><span class=nx>counter</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=kd>struct</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>m</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}{</span><span class=nx>m</span><span class=p>:</span><span class=w> </span><span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>int</span><span class=p>)}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Для чтения из счётчика возьмите <strong>блокировку на чтение</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>counter</span><span class=p>.</span><span class=nf>RLock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>counter</span><span class=p>.</span><span class=nx>m</span><span class=p>[</span><span class=s>&#34;some_key&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>counter</span><span class=p>.</span><span class=nf>RUnlock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;some_key:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>n</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Для записи в счётчик возьмите <strong>блокировку на запись</strong>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>counter</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>counter</span><span class=p>.</span><span class=nx>m</span><span class=p>[</span><span class=s>&#34;some_key&#34;</span><span class=p>]</span><span class=o>++</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>counter</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=порядок-итерации>Порядок итерации</h3><p>При итерации по map с помощью цикла <code>range</code> <strong>порядок итерации не определён</strong> и не гарантируется одинаковым от одной итерации к другой. Если требуется <strong>стабильный порядок итерации</strong>, необходимо поддерживать отдельную структуру данных, которая задаёт этот порядок. В этом примере используется отдельный отсортированный срез ключей для вывода map <code>map[int]string</code> в порядке ключей:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=s>&#34;sort&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=kt>string</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>var</span><span class=w> </span><span class=nx>keys</span><span class=w> </span><span class=p>[]</span><span class=kt>int</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>k</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>m</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>keys</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=nb>append</span><span class=p>(</span><span class=nx>keys</span><span class=p>,</span><span class=w> </span><span class=nx>k</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nx>sort</span><span class=p>.</span><span class=nf>Ints</span><span class=p>(</span><span class=nx>keys</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>for</span><span class=w> </span><span class=nx>_</span><span class=p>,</span><span class=w> </span><span class=nx>k</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>range</span><span class=w> </span><span class=nx>keys</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Key:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>k</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Value:&#34;</span><span class=p>,</span><span class=w> </span><span class=nx>m</span><span class=p>[</span><span class=nx>k</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></div><div class=lesson-meta><p class=article-date><time>30.11.2025</time></p></div><nav class=lesson-navigation><div class=nav-container><span class="nav-btn next disabled">Завершение →</span></div></nav><div class=original-doc-link><a href=https://go.dev/blog/maps target=_blank rel=noopener>Оригинал статьи на сайте go.dev</a></div></article></div></main><footer class=footer><p>© 2025 Go-Котяра</p></footer></div><script src=../../js/go-playground.min.ba9ba48e8bbe056aa2187849e18077201280e49fb76376d968a29e81e1d9e203.js defer></script></body></html>